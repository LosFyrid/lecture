apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: lecture
  namespace: lecture
spec:
  interval: 10m
  chartRef:
    kind: OCIRepository
    name: lecture-chart
  values:
    ingress:
      enabled: true
      className: traefik
      certManager:
        enabled: true
        clusterIssuer: letsencrypt-prod
      hosts:
        - host: lecture.example.com
      tls:
        enabled: true
        secretName: lecture-tls
      traefik:
        # If your cluster still uses the legacy CRD group:
        # crdApiVersion: traefik.containo.us/v1alpha1
        crdApiVersion: traefik.io/v1alpha1
      assetsProtection:
        enabled: true
        inFlightReq:
          enabled: true
          amount: 20
          ipStrategyDepth: 1
        rateLimit:
          enabled: true
          average: 60
          burst: 120
          period: ""
          ipStrategyDepth: 1
    web:
      image:
        repository: harbor.example.com/lecture/web
        tag: "abc1234"
    api:
      image:
        repository: harbor.example.com/lecture/api
        tag: "abc1234"
      env:
        assetAllowedPrefixes: "pdf/,archive/"
        assetCacheControlDefault: "public, max-age=3600"
        assetCacheControlImmutable: "public, max-age=31536000, immutable"
      minio:
        endpoint: "minio.example.com:9000"
        useSSL: true
        bucket: "lecture"
        existingSecret: "lecture-minio"

